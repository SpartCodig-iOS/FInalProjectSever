<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Supabase 애플 로그인 테스트</title>
  <style>
    body { font-family: sans-serif; margin: 2rem; }
    label { display: block; margin-bottom: 0.5rem; }
    input { width: 360px; padding: 0.4rem; }
    button { margin-top: 1rem; padding: 0.6rem 1.2rem; font-size: 1rem; }
    pre { background: #f5f5f5; padding: 1rem; min-height: 120px; }
  </style>
</head>
<body>
  <h1>Supabase 애플 로그인 테스트</h1>
  <p>버튼을 누르면 서버(`/api/v1/auth/apple`)가 생성한 Supabase 로그인 URL로 이동합니다.</p>

  <label>
    Redirect To (선택)
    <input id="redirectTo" placeholder="http://localhost:8080/api/v1/auth/apple/callback" />
  </label>
  <label>
    Client State (선택)
    <input id="clientState" placeholder="web-test" />
  </label>

  <button id="loginBtn">애플 로그인</button>

  <h2>API 응답</h2>
  <pre id="result">(버튼을 눌러 응답 확인)</pre>

  <script>
    document.getElementById('loginBtn').addEventListener('click', async () => {
      const redirectTo = document.getElementById('redirectTo').value.trim();
      const clientState = document.getElementById('clientState').value.trim();
      const params = new URLSearchParams();
      if (redirectTo) params.set('redirectTo', redirectTo);
      if (clientState) params.set('clientState', clientState);
      const endpoint = `/api/v1/auth/apple${params.toString() ? `?${params}` : ''}`;
      const resEl = document.getElementById('result');
      resEl.textContent = '요청 중...';
      try {
        const response = await fetch(endpoint);
        const payload = await response.json();
        resEl.textContent = JSON.stringify(payload, null, 2);
        if (payload?.data?.url) {
          window.location.href = payload.data.url;
        }
      } catch (error) {
        resEl.textContent = error?.message || String(error);
      }
    });
  </script>
</body>
</html>
